"use strict";angular.module("spotifyApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","angular-loading-bar","checklist-model","ui.bootstrap","ui.sortable","angucomplete-alt"]).constant("config",{clientId:"84239147f2e54cfca600f89fade24f71",clientSecret:"f67c24958fa24a709bafe4868e7bad72",redirectUri:"http://emascarinas.github.io/spotify/#/",scopes:"user-read-private user-read-email",accountUrl:"https://accounts.spotify.com",authorizeEnd:"/authorize",tokenEnd:"/api/token",itemsPerPage:20,pageMaxSize:5,apiUrl:"https://api.spotify.com/v1",meEnd:"/me",searchEnd:"/search",curlUrl:"http://dunggoanan.com/curlspo.php"}).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/login",{templateUrl:"views/about.html",controller:"LoginCtrl"}).when("/search",{templateUrl:"views/search.html",controller:"SearchCtrl"}).when("/playlist",{templateUrl:"views/playlist.html",controller:"PlaylistCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("spotifyApp").controller("MainCtrl",["$scope","session","$location","util","user",function(a,b,c,d,e){var f=new RegExp("code=(.*)#/"),g=c.absUrl().match(f);void 0===b.getCode()&&null!==g&&b.setCode(g),a.profile=b.getProfile(),console.log(a.profile),d.isEmptyToken()&&(b.setCode(g[1]),e.getAccessToken().success(function(c){b.setAccessToken(c.access_token),e.getMeProfile().success(function(c){b.setProfile(c),a.profile=b.getProfile()}).error(function(a){console.log(a)})}).error(function(a){console.log(a)}))}]),angular.module("spotifyApp").controller("LoginCtrl",["config","util",function(a,b){var c={client_id:a.clientId,response_type:"code",redirect_uri:a.redirectUri,scope:a.scopes,show_dialog:!0};b.redirect(a.accountUrl+a.authorizeEnd+"/?"+b.buildParam(c))}]),angular.module("spotifyApp").factory("user",["config","$http","session",function(a,b,c){return{getAccessToken:function(){var d=a.accountUrl+a.tokenEnd,e="grant_type=authorization_code&code="+c.getCode()+"&redirect_uri="+a.redirectUri;return b.post(a.curlUrl,{url:d,param:e})},getMeProfile:function(){return b.get(a.apiUrl+a.meEnd,{headers:{Authorization:"Bearer "+c.getAccessToken()}})}}}]),angular.module("spotifyApp").service("util",["$window","session","$modal","config",function(a,b,c,d){this.redirect=function(b){a.location.replace(b)},this.buildParam=function(a){return $.param(a)},this.isEmptyToken=function(){return void 0===b.getAccessToken()&&void 0!==b.getCode()},this.showError=function(a){c.open({templateUrl:"erroModal.html",controller:"ModalInstanceCtrl",size:"sm",resolve:{error:function(){return a}}})},this.computeOffset=function(a){return 1===a?0:(a-1)*d.itemsPerPage}}]),angular.module("spotifyApp").factory("session",function(){var a,b,c;return{getProfile:function(){return b},setProfile:function(a){b=a},getCode:function(){return a},setCode:function(b){a=b},getAccessToken:function(){return c},setAccessToken:function(a){c=a}}}),angular.module("spotifyApp").factory("song",["$http","config","util",function(a,b,c){return{search:function(d,e,f){var g=c.buildParam({q:d,type:"track",offset:e,limit:f});return a.get(b.apiUrl+b.searchEnd+"?"+g)}}}]),angular.module("spotifyApp").controller("ModalInstanceCtrl",["$scope","$modalInstance","error","config",function(a,b,c,d){a.error=c,a.ok=function(){"access_token_required"===c.error_name&&(window.location="/"+d.uriBase),b.close()}}]),angular.module("spotifyApp").controller("SearchCtrl",["$scope","song","localStorage","util","$location","config",function(a,b,c,d,e,f){function g(c,d,e){b.search(c,d,e).success(function(b){a.songList=b.tracks.items,a.totalItems=b.tracks.total}).error(function(a){console.log(a)})}a.songs={selected:[]},a.songList=[],a.checkAll=function(){a.songs.selected=angular.copy(a.songList)},a.uncheckAll=function(){a.songs.selected=[]},a.addPlaylist=function(){if(a.songs.selected.length){var b=c.getData();c.setData(b.concat(a.songs.selected)),e.path("playlist")}else d.showError({errorName:"Error",errorMessage:"Select a song"})},a.remoteUrlRequestFn=function(a){return{q:a,type:"track"}},a.selectedSong=function(b){a.songList=[b.originalObject]},a.goSearch=function(){a.query=1===a.songList.length?a.songList[0].name:a.query,void 0!==a.query&&a.query.length?g(a.query,d.computeOffset(a.currentPage),f.itemsPerPage):d.showError({errorName:"Error",errorMessage:"Search value required"})},a.pageChanged=function(){g(a.query,d.computeOffset(a.currentPage),f.itemsPerPage)},a.inputChanged=function(b){a.songList=[],a.currentPage=1,a.totalItems=0,a.query=b}}]),angular.module("spotifyApp").controller("PlaylistCtrl",["$scope","localStorage",function(a,b){function c(){a.total=0,a.songs.length&&(a.total=a.songs.reduce(function(a,b){return a+b.duration_ms},0))}a.songs=b.getData(),c(),a.clear=function(){b.setData([]),a.songs=b.getData(),c()},a.sortableOptions={stop:function(){b.setData(a.songs)}},a.remove=function(d){var e=a.songs.indexOf(d);a.songs.splice(e,1),c(),b.setData(a.songs)}}]),angular.module("spotifyApp").controller("CommonCtrl",["$scope","config","localStorage",function(a,b,c){c.init(),a.currentPage=1,a.maxSize=b.pageMaxSize,a.itemsPerPage=b.itemsPerPage,a.boundaryLinks=!0,a.rotate=!1}]),angular.module("spotifyApp").service("localStorage",function(){this.init=function(){localStorage.getItem("data")||localStorage.setItem("data",JSON.stringify([]))},this.getData=function(){return JSON.parse(localStorage.getItem("data"))},this.setData=function(a){return localStorage.setItem("data",JSON.stringify(a))},this.clear=function(){localStorage.clear()}}),angular.module("ui.sortable",[]).value("uiSortableConfig",{}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(a,b,c){return{require:"?ngModel",scope:{ngModel:"=",uiSortable:"="},link:function(d,e,f,g){function h(a,b){return b&&"function"==typeof b?function(){a.apply(this,arguments),b.apply(this,arguments)}:a}function i(a){var b=a.data("ui-sortable");return b&&"object"==typeof b&&"ui-sortable"===b.widgetFullName?b:null}function j(a,b){var c=a.sortable("option","helper");return"clone"===c||"function"==typeof c&&b.item.sortable.isCustomHelperUsed()}function k(a){return/left|right/.test(a.css("float"))||/inline|table-cell/.test(a.css("display"))}function l(a,b){for(var c=null,d=0;d<a.length;d++){var e=a[d];if(e.element[0]===b[0]){c=e.scope;break}}return c}function m(a,b){b.item.sortable._destroy()}var n,o={},p={"ui-floating":void 0},q={receive:null,remove:null,start:null,stop:null,update:null},r={helper:null};return angular.extend(o,p,a,d.uiSortable),angular.element.fn&&angular.element.fn.jquery?(g?(d.$watch("ngModel.length",function(){b(function(){i(e)&&e.sortable("refresh")},0,!1)}),q.start=function(a,b){if("auto"===o["ui-floating"]){var c=b.item.siblings(),d=i(angular.element(a.target));d.floating=k(c)}b.item.sortable={model:g.$modelValue[b.item.index()],index:b.item.index(),source:b.item.parent(),sourceModel:g.$modelValue,cancel:function(){b.item.sortable._isCanceled=!0},isCanceled:function(){return b.item.sortable._isCanceled},isCustomHelperUsed:function(){return!!b.item.sortable._isCustomHelperUsed},_isCanceled:!1,_isCustomHelperUsed:b.item.sortable._isCustomHelperUsed,_destroy:function(){angular.forEach(b.item.sortable,function(a,c){b.item.sortable[c]=void 0})}}},q.activate=function(a,b){n=e.contents();var c=e.sortable("option","placeholder");if(c&&c.element&&"function"==typeof c.element){var f=c.element();f=angular.element(f);var g=e.find('[class="'+f.attr("class")+'"]:not([ng-repeat], [data-ng-repeat])');n=n.not(g)}var h=b.item.sortable._connectedSortables||[];h.push({element:e,scope:d}),b.item.sortable._connectedSortables=h},q.update=function(a,b){if(!b.item.sortable.received){b.item.sortable.dropindex=b.item.index();var c=b.item.parent();b.item.sortable.droptarget=c;var f=l(b.item.sortable._connectedSortables,c);b.item.sortable.droptargetModel=f.ngModel,e.sortable("cancel")}j(e,b)&&!b.item.sortable.received&&"parent"===e.sortable("option","appendTo")&&(n=n.not(n.last())),n.appendTo(e),b.item.sortable.received&&(n=null),b.item.sortable.received&&!b.item.sortable.isCanceled()&&d.$apply(function(){g.$modelValue.splice(b.item.sortable.dropindex,0,b.item.sortable.moved)})},q.stop=function(a,b){!b.item.sortable.received&&"dropindex"in b.item.sortable&&!b.item.sortable.isCanceled()?d.$apply(function(){g.$modelValue.splice(b.item.sortable.dropindex,0,g.$modelValue.splice(b.item.sortable.index,1)[0])}):"dropindex"in b.item.sortable&&!b.item.sortable.isCanceled()||j(e,b)||n.appendTo(e),n=null},q.receive=function(a,b){b.item.sortable.received=!0},q.remove=function(a,b){"dropindex"in b.item.sortable||(e.sortable("cancel"),b.item.sortable.cancel()),b.item.sortable.isCanceled()||d.$apply(function(){b.item.sortable.moved=g.$modelValue.splice(b.item.sortable.index,1)[0]})},r.helper=function(a){return a&&"function"==typeof a?function(b,c){var d=a.apply(this,arguments);return c.sortable._isCustomHelperUsed=c!==d,d}:a},d.$watch("uiSortable",function(a){var b=i(e);b&&angular.forEach(a,function(a,c){return c in p?("ui-floating"!==c||a!==!1&&a!==!0||(b.floating=a),void(o[c]=a)):(q[c]?("stop"===c&&(a=h(a,function(){d.$apply()}),a=h(a,m)),a=h(q[c],a)):r[c]&&(a=r[c](a)),o[c]=a,void e.sortable("option",c,a))})},!0),angular.forEach(q,function(a,b){o[b]=h(a,o[b]),"stop"===b&&(o[b]=h(o[b],m))})):c.info("ui.sortable: ngModel not provided!",e),void e.sortable(o)):void c.error("ui.sortable: jQuery should be included before AngularJS!")}}}]),angular.module("spotifyApp").filter("minutes",function(){return function(a){var b=Math.floor(a/6e4),c=(a%6e4/1e3).toFixed(0);return b+":"+(10>c?"0":"")+c}}),angular.module("spotifyApp").directive("spotifyPaginator",function(){return{templateUrl:"views/paginator.html",restrict:"E"}});